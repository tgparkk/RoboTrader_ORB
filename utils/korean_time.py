"""
한국 시장 시간 관련 유틸리티
market_hours.py로 이관됨 (하위 호환성 유지)
"""
from datetime import datetime
import pytz

# 하위 호환성을 위해 기존 함수들 유지
# 실제 구현은 config.market_hours.MarketHours 사용
try:
    from config.market_hours import MarketHours, KST as _KST
    KST = _KST
except ImportError:
    # fallback: config.market_hours를 찾을 수 없을 때
    KST = pytz.timezone('Asia/Seoul')
    from datetime import time

    def now_kst() -> datetime:
        """현재 한국 시간 반환"""
        return datetime.now(KST)

    def is_market_open(dt: datetime = None) -> bool:
        """장중 시간인지 확인 (fallback)"""
        if dt is None:
            dt = now_kst()

        if dt.weekday() >= 5:
            return False

        market_open = time(9, 0)
        market_close = time(15, 30)
        current_time = dt.time()
        return market_open <= current_time <= market_close

    def is_before_market_open(dt: datetime = None) -> bool:
        """장 시작 전인지 확인 (fallback)"""
        if dt is None:
            dt = now_kst()

        if dt.weekday() >= 5:
            return False

        market_open = time(9, 0)
        current_time = dt.time()
        return current_time < market_open

    def get_market_status() -> str:
        """시장 상태 반환 (fallback)"""
        now = now_kst()

        if now.weekday() >= 5:
            return "weekend"
        elif is_before_market_open(now):
            return "pre_market"
        elif is_market_open(now):
            return "market_open"
        else:
            return "after_market"
else:
    # config.market_hours를 정상적으로 import한 경우
    def now_kst() -> datetime:
        """현재 한국 시간 반환"""
        return datetime.now(KST)

    def is_market_open(dt: datetime = None) -> bool:
        """장중 시간인지 확인 (KRX 기준, 특수일 자동 반영)"""
        return MarketHours.is_market_open('KRX', dt)

    def is_before_market_open(dt: datetime = None) -> bool:
        """장 시작 전인지 확인 (KRX 기준, 특수일 자동 반영)"""
        return MarketHours.is_before_market_open('KRX', dt)

    def get_market_status() -> str:
        """시장 상태 반환 (KRX 기준, 특수일 자동 반영)"""
        return MarketHours.get_market_status('KRX')