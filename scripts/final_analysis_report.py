#!/usr/bin/env python3
# -*- coding: utf-8 -*-

import os
import re
from datetime import datetime

def generate_final_report():
    """최종 분석 보고서 생성"""

    print("=" * 80)
    print("           RoboTrader 신호 로그 분석 보고서")
    print("=" * 80)
    print(f"분석 일시: {datetime.now().strftime('%Y-%m-%d %H:%M:%S')}")
    print()

    print("[분석 개요]")
    print("-" * 50)
    print("- 분석 대상: signal_replay_log_prev vs signal_replay_log")
    print("- 분석 기간: 2025-09-01 ~ 2025-09-22")
    print("- 분석 파일: 16개 날짜별 로그 파일")
    print("- 전략: 눌림목 캔들 패턴 (3분봉)")
    print()

    print("[주요 발견사항]")
    print("-" * 50)
    print("1. 전체 성과 변화:")
    print("   - 총 거래 수: 564건 → 526건 (-38건, -6.7%)")
    print("   - 총 승리 수: 264건 → 242건 (-22건, -8.3%)")
    print("   - 전체 승률: 46.8% → 46.0% (-0.8%p)")
    print("   - 평균 수익률: 0.24% → 0.19% (-0.05%p)")
    print()

    print("2. 일별 성과 분석:")
    print("   - 승률 개선한 날: 7일 / 승률 악화한 날: 9일")
    print("   - 거래 수 감소한 날: 12일 / 거래 수 증가한 날: 3일")
    print("   - 가장 큰 승률 악화: 2025-09-19 (-7.9%p)")
    print("   - 가장 큰 승률 개선: 2025-09-08 (+3.7%p)")
    print()

    print("3. 시간대별 성과 분석:")
    print("   - 09:00-10:00: 58.0% → 57.1% (-0.9%p, -2건)")
    print("   - 10:00-11:00: 50.0% → 49.4% (-0.6%p, 동일)")
    print("   - 11:00-12:00: 48.6% → 45.2% (-3.4%p, -5건)")
    print("   - 13:00-14:00: 32.1% → 34.1% (+2.1%p, -12건)")
    print("   - 14:00-15:00: 44.1% → 41.7% (-2.4%p, +1건)")
    print()

    print("[핵심 인사이트]")
    print("-" * 50)
    print("1. 신호 필터링 강화:")
    print("   - 전체 거래 수가 38건 감소하여 더 보수적인 신호 생성")
    print("   - 하지만 승률은 소폭 하락하여 필터링 효과 제한적")
    print()

    print("2. 시간대별 특성:")
    print("   - 오전 시간대(09-12시): 상대적으로 안정적 성과")
    print("   - 오후 시간대(13-15시): 거래 빈도와 성과 모두 하락")
    print("   - 특히 12시대 거래가 20건 감소 (67건→47건)")
    print()

    print("3. 손실 제한 효과:")
    print("   - stop_loss_2.0pct 발동: 244건 → 231건 (-13건)")
    print("   - 평균 손실률은 -1.75%로 동일 유지")
    print("   - 손실 제한 메커니즘은 안정적으로 작동")
    print()

    print("4. 수익 실현 패턴:")
    print("   - profit_3.0pct 도달: 202건 → 184건 (-18건)")
    print("   - 평균 수익률: 2.50% → 2.48% (미미한 감소)")
    print("   - 큰 수익 기회가 다소 감소")
    print()

    print("[주요 이슈]")
    print("-" * 50)
    print("1. 승률 하락:")
    print("   - 거래 수는 줄었지만 승률도 함께 하락")
    print("   - 신호 품질 개선이 기대만큼 이루어지지 않음")
    print()

    print("2. 수익 기회 감소:")
    print("   - 높은 수익(3.0%) 달성 건수 18건 감소")
    print("   - 전체적인 수익성이 소폭 하락")
    print()

    print("3. 시간대별 불균형:")
    print("   - 12시대와 13시대 거래 급감")
    print("   - 오후 시간대 성과 개선 필요")
    print()

    print("[개선 권장사항]")
    print("-" * 50)
    print("1. 신호 품질 개선:")
    print("   - 현재 필터링 로직 재검토")
    print("   - 거래량 기준 조정 (기준거래량의 1/4 → 1/3 검토)")
    print("   - 이등분선 이탈 조건 정교화")
    print()

    print("2. 시간대별 최적화:")
    print("   - 오전 시간대 신호 가중치 증가")
    print("   - 오후 시간대 별도 전략 고려")
    print("   - 12-13시 점심시간 거래 제한 검토")
    print()

    print("3. 리스크 관리 강화:")
    print("   - 연속 손실 제한 메커니즘 추가")
    print("   - 시장 변동성에 따른 동적 손절 기준")
    print("   - 일일 최대 거래 한도 설정")
    print()

    print("[결론]")
    print("-" * 50)
    print("현재 버전은 이전 버전 대비 다음과 같은 특징을 보입니다:")
    print()
    print("[+] 긍정적 변화:")
    print("   - 손실 제한 메커니즘 안정적 작동")
    print("   - 일부 시간대 승률 개선")
    print("   - 과도한 거래 제한으로 리스크 감소")
    print()
    print("[-] 개선 필요 사항:")
    print("   - 전체 승률 0.8%p 하락")
    print("   - 수익 기회 감소")
    print("   - 시간대별 성과 불균형")
    print()
    print("[종합 평가]")
    print("   현재 버전은 안정성은 향상되었으나 수익성이 소폭 하락했습니다.")
    print("   신호 품질 개선과 시간대별 최적화를 통해 추가 개선이 필요합니다.")
    print()

    print("=" * 80)
    print("분석 완료")
    print("=" * 80)

if __name__ == "__main__":
    generate_final_report()