# 2026-01-19 후보 종목 선정 실패 해결 방안

## 문제 상황
- **일자:** 2026-01-19 (월요일) - 정상 거래일
- **시간:** 08:30:04 장전 후보 종목 선정
- **결과:** Universe 300개 검사 → **0개 선정** ❌
- **원인:** "갭 상승 조건을 만족하는 후보 종목이 없습니다"

## 핵심 원인

### 1. 갭 조건이 너무 엄격
```python
# config/orb_strategy_config.py 라인 23-25
min_gap_ratio: 0.003  # 0.3%
max_gap_ratio: 0.03   # 3%
gap_direction: "up"   # 상승만 허용
```

**문제점:**
- 0.3% 미만 갭: 제외
- 하락 갭: 제외  
- 3% 초과 갭: 제외
- → 평범한 시장에서는 선정 불가

### 2. 08:30 시점의 데이터 문제
- 장 시작 전 (09:00 이전)
- 시가가 아직 확정되지 않음
- API `current_price`가 부정확할 가능성

---

## 해결 방안

### 🚀 방법 1: 갭 조건 완화 (권장!)

**파일:** `config/orb_strategy_config.py`

**현재 설정 (라인 22-25):**
```python
# 갭 기준 (전일 종가 대비 당일 시가)
min_gap_ratio: float = 0.003  # 최소 갭 0.3%
max_gap_ratio: float = 0.03   # 최대 갭 3%
gap_direction: str = "up"     # 갭 방향: "up" (상승), "down" (하락), "both" (양방향)
```

**권장 변경 (옵션 A - 보수적):**
```python
min_gap_ratio: float = 0.001  # 최소 갭 0.1%
max_gap_ratio: float = 0.05   # 최대 갭 5%
gap_direction: str = "both"   # 상승/하락 모두 허용
```

**권장 변경 (옵션 B - 공격적):**
```python
min_gap_ratio: float = 0.0005  # 최소 갭 0.05%
max_gap_ratio: float = 0.08    # 최대 갭 8%
gap_direction: str = "both"    # 상승/하락 모두 허용
```

**적용 방법:**
1. `config/orb_strategy_config.py` 파일 열기
2. 라인 23-25 수정
3. 파일 저장
4. 봇 재시작 (`run_robotrader.bat`)

---

### 🚀 방법 2: 후보 선정 시간 변경

현재 후보 선정이 08:30 (장 시작 전)에 진행됩니다.  
시가가 확정된 후로 변경하는 것이 좋습니다.

**파일:** `main.py`

08:30 → 09:05로 변경하여 시가 확정 후 선정

---

### 🚀 방법 3: 로그 레벨 변경 (디버깅용)

현재는 DEBUG 로그가 출력되지 않아 어떤 종목이 왜 탈락했는지 알 수 없습니다.

**파일:** `utils/logger.py` 또는 로그 설정 파일

로그 레벨을 `INFO` → `DEBUG`로 변경하면 다음과 같은 메시지를 볼 수 있습니다:
```
[ORB 전략] ❌ 005930: 갭 범위 벗어남 (0.12%)
[ORB 전략] ❌ 000660: 거래대금 부족 (87.3억)
[ORB 전략] ❌ 035720: 갭 범위 벗어남 (-0.25%)
```

---

## 즉시 실행 가능한 조치

### ✅ 최우선 (5분 소요)

1. **`config/orb_strategy_config.py` 수정:**
   ```python
   min_gap_ratio: float = 0.001  # 0.3% → 0.1%
   max_gap_ratio: float = 0.05   # 3% → 5%
   gap_direction: str = "both"   # "up" → "both"
   ```

2. **봇 재시작:**
   ```cmd
   # 현재 실행 중인 봇 종료 (Ctrl+C)
   # 재시작
   run_robotrader.bat
   ```

3. **내일(1/20) 08:30 모니터링:**
   - 로그에서 "후보 종목 선정 완료: X개" 확인
   - 0개가 아닌지 확인

### ⚙️ 추가 조치 (선택사항)

4. **Universe 업데이트:**
   ```cmd
   python scripts/update_weekly_universe.py
   ```
   (현재 16일 전 데이터 사용 중)

5. **계좌 상태 확인:**
   - 현재 잔액: 15원 (테스트 계좌로 추정)
   - 실제 거래 원한다면 자금 입금 필요

6. **API 호출 빈도 조정:**
   - "초당 거래건수 초과" 에러 발생 (2건)
   - `api/kis_api_manager.py`에서 호출 간격 증가

---

## 검증 방법

### 내일(2026-01-20) 체크리스트

```
[ ] 08:20 - 시스템 로그 확인
[ ] 08:30 - 후보 종목 선정 개수 확인 (0개가 아닌지)
[ ] 로그에서 "✅ 후보 선정: XXX(000000)" 메시지 확인
[ ] 09:00 - ORB 레인지 계산 확인
[ ] 09:10 - 매수 신호 발생 여부 확인
```

**예상 결과 (변경 후):**
```
08:30:04 - Universe 로드 완료: 300개 종목
08:30:04 - [ORB 전략] 후보 종목 선정 시작
08:30:05 - [ORB 전략] ✅ 후보 선정: 삼성전자(005930) - 점수: 70, 이유: ...
08:30:06 - [ORB 전략] ✅ 후보 선정: SK하이닉스(000660) - 점수: 65, 이유: ...
...
08:30:30 - [ORB 전략] 후보 종목 선정 완료: 15개  ← 0개가 아님!
```

---

## 참고 자료

- 생성된 분석 파일:
  - `analysis_result.txt` - 로그 요약
  - `detailed_report_20260119.txt` - DB 분석
  
- 관련 코드:
  - `config/orb_strategy_config.py` - 전략 설정
  - `strategies/orb_strategy.py` - 후보 선정 로직
  - `main.py` - 메인 실행 파일

---

## 결론

**오늘(2026-01-19)은 시스템에 문제가 있는 것이 아니라,**  
**선정 조건이 너무 엄격하여 단 한 종목도 선정되지 않은 것입니다.**

가장 빠른 해결책은 **갭 조건 완화**입니다.  
위의 방법 1을 적용하시면 내일부터 후보 종목이 선정될 것입니다.

---
**작성일:** 2026-01-19 21:20  
**작성자:** RoboTrader 분석 시스템
